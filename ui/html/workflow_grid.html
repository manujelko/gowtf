{{ define "content" }}
<div class="workflow-header">
    <h2>{{ .Workflow.Name }}</h2>
    <p>
        {{ if .Workflow.Schedule }}
            <code>{{ .Workflow.Schedule }}</code>
        {{ else }}
            <span style="color: var(--status-pending); font-style: italic;">Manual only (no schedule)</span>
        {{ end }}
    </p>
    <div style="display: flex; gap: 1rem; align-items: center; margin-top: 1rem;">
        <button 
            class="trigger-btn btn"
            hx-post="/api/workflow/{{ .Workflow.ID }}/trigger"
            hx-swap="none"
            hx-trigger="click"
            hx-on::after-request="if(event.detail.xhr.status === 200) { setTimeout(() => location.reload(), 500); } else { alert('Failed to trigger workflow: ' + event.detail.xhr.responseText); }"
            title="Trigger workflow manually">
            ▶ Trigger Workflow
        </button>
        <a href="/">← Back to Dashboard</a>
    </div>
</div>

<div id="workflow-grid-container" hx-trigger="every 5s" hx-get="/workflow/{{ .Workflow.ID }}" hx-swap="outerHTML">
    {{ template "workflow-grid" . }}
</div>
{{ end }}

{{ define "workflow-grid" }}
<div id="workflow-grid-container" hx-trigger="every 5s" hx-get="/workflow/{{ .Workflow.ID }}" hx-swap="outerHTML">
    <div class="run-grid">
        {{ range .Cells }}
        {{ if .IsFuture }}
        <div class="grid-cell future" 
             title="Scheduled: {{ .Time.Format "Jan 02 15:04:05" }}">
            <span class="cell-time">{{ .Time.Format "15:04" }}</span>
        </div>
        {{ else }}
        <a href="/run/{{ .Run.ID }}" class="grid-cell status-{{ .Status }}" 
           title="{{ .Status }} - {{ .Time.Format "Jan 02 15:04:05" }}">
            <span class="cell-time">{{ .Time.Format "15:04" }}</span>
        </a>
        {{ end }}
        {{ end }}
    </div>

    <div class="grid-legend">
        <h3>Legend</h3>
        <div class="legend-items">
            <div class="legend-item">
                <span class="legend-color status-success"></span>
                <span>Success</span>
            </div>
            <div class="legend-item">
                <span class="legend-color status-failed"></span>
                <span>Failed</span>
            </div>
            <div class="legend-item">
                <span class="legend-color status-running"></span>
                <span>Running</span>
            </div>
            <div class="legend-item">
                <span class="legend-color status-pending"></span>
                <span>Pending</span>
            </div>
            <div class="legend-item">
                <span class="legend-color future"></span>
                <span>Future</span>
            </div>
        </div>
    </div>
</div>
{{ end }}

